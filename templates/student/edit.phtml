<div class="row">
<div class="col-md-12">
    <h3><?=$lang->g('title', 'student-edit')?> <small><?=$lang->g('heading', 'student-edit')?></small>
        <div class="btn-group pull-right">
            <?php if (isset($listID) && !is_null($listID) && $counts[0] == $counts[1] && $counts[2] == $counts[3]):?>
            <a href="<?=$router->pathFor('subjects-student-preview', ['id' => $listID])?>" class="btn btn-success"><?=$lang->g('finish', 'student-edit')?></a>
            <?php else:?>
            <button class="btn btn-success disabled"><?=$lang->g('finish', 'student-edit')?></button>
            <?php endif;?>
            <a href="<?=$router->pathFor('subjects-student')?>" class="btn btn-default"><?=$lang->g('back', 'student-edit')?></a>
        </div>
    </h3>
    <hr />
    <span class="pull-right <?=$counts[0]>$counts[1]||$counts[2]>2?'text-danger':''?>" style="margin-bottom: 9px; margin-top: -8px;">
        <?=$lang->g('status', 'student-edit', ['normal' => $counts[0] . '/'. $counts[1], 'spare' => $counts[2] . '/' . $counts[3]])?>
    </span>
</div>
</div>
<div class="col-md-12">
    <div class="list-group">
        <?php foreach ($subjects as $subject):?>
        <div class="list-group-item <?=
            is_numeric($subject['level']) ? ($state == 3 ?[
                    'disabled',
                    'list-group-item-info',
                    'list-group-item-warning',
                    'list-group-item-success'
                ]:[
                    'list-group-item-success',
                    'list-group-item-info',
                    'list-group-item-warning',
                    'list-group-item-success',
                ])[$subject['level']] : ''
            ?>" style="display: flow-root">
            <div class="col-md-10">
                <h4 class="list-group-item-heading " style="margin-bottom: 10px;">
                <?php if (is_numeric($subject['level'])):?>
                    <small style="margin-bottom: 9px;display: inline-block;"><?=$lang->g('enroled-as-' . $subject['level'], 'student-edit')?></small><br />
                <?php endif;?>
                <b><i><?=$subject['code']?>:</i> <?=$subject['name']?></b>
                </h4>
                <p class="list-group-item-text">
                    <?=str_replace('\n', '<br /><br />', $subject['annotation'])?>
                </p>
            </div>
            <?php if (!($state == 3 && is_numeric($subject['level']) && $subject['level'] == 0)):?>
            <div class="col-md-2">
                <div class="btn-group pull-right">
                    <button type="button" onclick="send(this, '<?=$subject['id']?>', '<?=is_numeric($subject['level'])?'cancel':'enrol'?>')" class="btn btn-default"><?=is_numeric($subject['level'])?$lang->g('cancel', 'student-edit'):$lang->g('enrol', 'student-edit')?></button>
                    <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu">
                        <li><a href="#" onclick="return send(this, '<?=$subject['id']?>', 'enrol');" class="btn <?=$subject['level'] === 0?'disabled':''?>"><?=$lang->g('enrol', 'student-edit')?></a></li>
                        <li><a href="#" onclick="return send(this, '<?=$subject['id']?>', 'spare1');" class="btn <?=$subject['level'] === 1?'disabled':''?>"><?=$lang->g('spare1', 'student-edit')?></a></li>
                        <li><a href="#" onclick="return send(this, '<?=$subject['id']?>', 'spare2');" class="btn <?=$subject['level'] === 2?'disabled':''?>"><?=$lang->g('spare2', 'student-edit')?></a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#" onclick="return send(this, '<?=$subject['id']?>', 'cancel');" class="btn <?=$subject['level'] === false?'disabled':''?>"><?=$lang->g('cancel', 'student-edit')?></a></li>
                    </ul>
                </div>
            </div>
            <?php endif;?>
        </div>
        <?php endforeach;?>
    </div>
</div>

<form method="post" action="<?=$router->pathFor('subjects-student-edit', ["id" => $listID])?>">
    <input type="hidden" name="<?= $csrf['nameKey'] ?>" value="<?= $csrf['name'] ?>">
    <input type="hidden" name="<?= $csrf['valueKey'] ?>" value="<?= $csrf['value'] ?>">
    <input type="hidden" name="_METHOD" value="PUT" />
    <input type="hidden" name="subject" id="form-subject" />
    <input type="hidden" name="action" id="form-action" />
</form>

<script>
function send(elm, subject, action) {
    if (elm.getAttribute('class').includes('disabled')) {
        return false;
    }
    document.getElementById('form-subject').value = subject
    var tmp = document.getElementById('form-action')
    tmp.value = action
    tmp.parentNode.submit()
}
</script>